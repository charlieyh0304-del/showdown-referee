<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ì‹œê°ì¥ì• ì¸ ìŠ¤í¬ì¸  ì‡¼ë‹¤ìš´ ì‹¬íŒìš© ì›¹ ì•±">
    <title>ì‡¼ë‹¤ìš´ ì‹¬íŒ ì•±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #1a73e8;
            --success: #34a853;
            --warning: #fbbc04;
            --danger: #ea4335;
            --dark: #202124;
            --light: #f8f9fa;
            --border: #dadce0;
        }
        body.high-contrast {
            --primary: #0000ff;
            --success: #00ff00;
            --warning: #ffff00;
            --danger: #ff0000;
            --dark: #000000;
            --light: #ffffff;
            --border: #000000;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
            color: var(--dark);
            -webkit-font-smoothing: antialiased;
        }
        *:focus { outline: 3px solid var(--primary); outline-offset: 2px; }
        .accessibility-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }
        .a11y-btn {
            min-width: 48px;
            min-height: 48px;
            border: 2px solid var(--primary);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        .header {
            text-align: center;
            padding: 24px;
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .card h2 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        .btn {
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            min-height: 48px;
            margin-bottom: 12px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .score-display {
            font-size: 72px;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
        }
        .score-btn {
            padding: 24px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            min-height: 80px;
            color: white;
            margin: 8px;
        }
        .goal { background: var(--success); }
        .mistake { background: var(--warning); }
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="accessibility-controls">
        <button id="contrast-btn" class="a11y-btn" title="ê³ ëŒ€ë¹„ ëª¨ë“œ">ğŸŒ“</button>
        <button id="voice-btn" class="a11y-btn" title="ìŒì„± ì•ˆë‚´">ğŸ”Š</button>
    </div>

    <div id="app" class="container"></div>

    <script>
        // ìŒì„± ì•ˆë‚´
        let voiceEnabled = localStorage.getItem('voice') !== 'false';
        function speak(text) {
            if (!voiceEnabled) return;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = 1.1;
            speechSynthesis.speak(utterance);
        }

        // ê³ ëŒ€ë¹„ ëª¨ë“œ
        document.getElementById('contrast-btn').onclick = () => {
            document.body.classList.toggle('high-contrast');
            const enabled = document.body.classList.contains('high-contrast');
            localStorage.setItem('highContrast', enabled);
            speak(enabled ? 'ê³ ëŒ€ë¹„ ëª¨ë“œ ì¼œì§' : 'ê³ ëŒ€ë¹„ ëª¨ë“œ êº¼ì§');
        };

        // ìŒì„± í† ê¸€
        document.getElementById('voice-btn').onclick = () => {
            voiceEnabled = !voiceEnabled;
            localStorage.setItem('voice', voiceEnabled);
            speak(voiceEnabled ? 'ìŒì„± ì•ˆë‚´ ì¼œì§' : 'ìŒì„± ì•ˆë‚´ êº¼ì§');
        };

        // ì•± ìƒíƒœ
        let screen = 'home';
        let matches = JSON.parse(localStorage.getItem('matches') || '[]');
        let currentMatch = null;

        function saveMatches() {
            localStorage.setItem('matches', JSON.stringify(matches));
        }

        function render() {
            const app = document.getElementById('app');
            
            if (screen === 'home') {
                app.innerHTML = `
                    <div class="header">
                        <h1>âš« ì‡¼ë‹¤ìš´ ì‹¬íŒ ì•±</h1>
                        <p>ì‹œê°ì¥ì• ì¸ ìŠ¤í¬ì¸  ê²½ê¸° ê¸°ë¡ ì‹œìŠ¤í…œ</p>
                    </div>
                    <div class="card">
                        <h2>ì‹œì‘í•˜ê¸°</h2>
                        <button class="btn btn-primary" onclick="goTo('create')">â• ìƒˆ ê²½ê¸° ìƒì„±</button>
                        <button class="btn btn-primary" onclick="goTo('list')">ğŸ“‹ ê²½ê¸° ëª©ë¡ ë³´ê¸°</button>
                    </div>
                    <div class="card">
                        <h2>ğŸ’¡ ì‚¬ìš© íŒ</h2>
                        <p style="line-height:1.8; color:#5f6368">
                        â€¢ ëª¨ë“  ë²„íŠ¼ì€ ìŒì„± ì•ˆë‚´ ì§€ì›<br>
                        â€¢ í™”ë©´ ë¦¬ë” í˜¸í™˜<br>
                        â€¢ ì ìˆ˜ ì…ë ¥ ì‹œ ìë™ ìŒì„± ì•ˆë‚´<br>
                        â€¢ ê³ ëŒ€ë¹„ ëª¨ë“œë¡œ ê°€ë…ì„± í–¥ìƒ
                        </p>
                    </div>
                `;
                speak('ì‡¼ë‹¤ìš´ ì‹¬íŒ ì•± í™ˆ í™”ë©´');
            }
            else if (screen === 'create') {
                app.innerHTML = `
                    <div class="card">
                        <h2>ìƒˆ ê²½ê¸° ìƒì„±</h2>
                        <label>ê²½ê¸° ìœ í˜•</label>
                        <select id="matchType">
                            <option value="individual">ê°œì¸ì „</option>
                            <option value="team">íŒ€ì „</option>
                        </select>
                        <div id="setsDiv">
                            <label>ì„¸íŠ¸ ìˆ˜</label>
                            <select id="sets">
                                <option value="3">3ì„¸íŠ¸</option>
                                <option value="5">5ì„¸íŠ¸</option>
                            </select>
                        </div>
                        <label id="player1Label">ì„ ìˆ˜ 1 ì´ë¦„</label>
                        <input type="text" id="player1" placeholder="ì„ ìˆ˜ 1 ì´ë¦„">
                        <label id="player2Label">ì„ ìˆ˜ 2 ì´ë¦„</label>
                        <input type="text" id="player2" placeholder="ì„ ìˆ˜ 2 ì´ë¦„">
                        <button class="btn btn-danger" onclick="goTo('home')">ì·¨ì†Œ</button>
                        <button class="btn btn-primary" onclick="createMatch()">ê²½ê¸° ì‹œì‘</button>
                    </div>
                `;
                document.getElementById('matchType').onchange = (e) => {
                    const isTeam = e.target.value === 'team';
                    document.getElementById('setsDiv').style.display = isTeam ? 'none' : 'block';
                    document.getElementById('player1Label').textContent = isTeam ? 'íŒ€ 1 ì´ë¦„' : 'ì„ ìˆ˜ 1 ì´ë¦„';
                    document.getElementById('player2Label').textContent = isTeam ? 'íŒ€ 2 ì´ë¦„' : 'ì„ ìˆ˜ 2 ì´ë¦„';
                    document.getElementById('player1').placeholder = isTeam ? 'íŒ€ 1 ì´ë¦„' : 'ì„ ìˆ˜ 1 ì´ë¦„';
                    document.getElementById('player2').placeholder = isTeam ? 'íŒ€ 2 ì´ë¦„' : 'ì„ ìˆ˜ 2 ì´ë¦„';
                };
            }
            else if (screen === 'match') {
                const set = currentMatch.setScores[currentMatch.currentSet - 1];
                const canEnd = Math.max(set.player1, set.player2) >= currentMatch.winScore && 
                              Math.abs(set.player1 - set.player2) >= 2;
                
                app.innerHTML = `
                    <div class="card">
                        <div style="text-align:center; padding:16px; background:var(--light); border-radius:8px; margin-bottom:16px">
                            <p>ì„¸íŠ¸ ${currentMatch.currentSet}/${currentMatch.sets}</p>
                        </div>
                        ${canEnd ? '<div style="padding:12px; background:#e6f4ea; border-radius:8px; margin-bottom:16px; color:#1e8e3e; font-weight:600">âœ… ì„¸íŠ¸ ì¢…ë£Œ ì¡°ê±´ ì¶©ì¡±</div>' : ''}
                        <div style="display:grid; grid-template-columns:1fr auto 1fr; gap:20px; align-items:center; margin:24px 0">
                            <div style="text-align:center">
                                <div style="font-size:20px; font-weight:600; margin-bottom:12px">${currentMatch.player1Name}</div>
                                <div class="score-display">${set.player1}</div>
                                ${currentMatch.currentServe === 'player1' ? '<div style="color:var(--success); font-weight:600">ğŸ¾ ì„œë¸Œ</div>' : ''}
                            </div>
                            <div style="font-size:24px; font-weight:700; color:#dadce0">VS</div>
                            <div style="text-align:center">
                                <div style="font-size:20px; font-weight:600; margin-bottom:12px">${currentMatch.player2Name}</div>
                                <div class="score-display">${set.player2}</div>
                                ${currentMatch.currentServe === 'player2' ? '<div style="color:var(--success); font-weight:600">ğŸ¾ ì„œë¸Œ</div>' : ''}
                            </div>
                        </div>
                        <h3>${currentMatch.player1Name} ë“ì </h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
                            <button class="score-btn goal" onclick="addScore('player1', 2, 'ê³¨')">âš« ê³¨<br>+2ì </button>
                            <button class="score-btn mistake" onclick="addScore('player1', 1, 'ìƒëŒ€ ì‹¤ìˆ˜')">âš ï¸ ìƒëŒ€ ì‹¤ìˆ˜<br>+1ì </button>
                        </div>
                        <h3>${currentMatch.player2Name} ë“ì </h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px">
                            <button class="score-btn goal" onclick="addScore('player2', 2, 'ê³¨')">âš« ê³¨<br>+2ì </button>
                            <button class="score-btn mistake" onclick="addScore('player2', 1, 'ìƒëŒ€ ì‹¤ìˆ˜')">âš ï¸ ìƒëŒ€ ì‹¤ìˆ˜<br>+1ì </button>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
                            <button class="btn btn-danger" onclick="undo()" ${currentMatch.history.length === 0 ? 'disabled' : ''}>â†©ï¸ ì·¨ì†Œ</button>
                            <button class="btn btn-success" onclick="endSet()">${currentMatch.currentSet < currentMatch.sets ? 'ì„¸íŠ¸ ì¢…ë£Œ' : 'ê²½ê¸° ì¢…ë£Œ'}</button>
                        </div>
                        <button class="btn btn-danger" onclick="goTo('home')" style="margin-top:12px">ğŸ  í™ˆìœ¼ë¡œ</button>
                    </div>
                    ${currentMatch.history.length > 0 ? `
                        <div class="card">
                            <h2>ê²½ê¸° ê¸°ë¡</h2>
                            ${currentMatch.history.slice(0, 5).map(h => `
                                <div style="padding:12px; margin:8px 0; background:var(--light); border-radius:6px; display:flex; justify-content:space-between">
                                    <span>${h.time} - ${h.player}</span>
                                    <span style="font-weight:700">${h.type} +${h.points}ì </span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                `;
            }
            else if (screen === 'list') {
                const active = matches.filter(m => m.status === 'active');
                const finished = matches.filter(m => m.status === 'finished');
                
                app.innerHTML = `
                    <div class="card">
                        <h2>ê²½ê¸° ëª©ë¡</h2>
                        ${active.length > 0 ? `
                            <h3 style="color:var(--success); margin:16px 0">ì§„í–‰ ì¤‘ì¸ ê²½ê¸°</h3>
                            ${active.map((m, i) => `
                                <div onclick="loadMatch(${i}, true)" style="padding:16px; background:white; border:2px solid var(--border); border-radius:8px; margin:12px 0; cursor:pointer">
                                    <h4>${m.player1Name} vs ${m.player2Name}</h4>
                                    <p style="color:#5f6368">${m.type === 'individual' ? 'ê°œì¸ì „' : 'íŒ€ì „'} Â· ì„¸íŠ¸ ${m.currentSet}/${m.sets}</p>
                                </div>
                            `).join('')}
                        ` : ''}
                        ${finished.length > 0 ? `
                            <h3 style="color:#5f6368; margin:24px 0 16px">ì™„ë£Œëœ ê²½ê¸°</h3>
                            ${finished.map((m, i) => `
                                <div onclick="loadMatch(${i}, false)" style="padding:16px; background:white; border:2px solid var(--border); border-radius:8px; margin:12px 0; cursor:pointer">
                                    <h4>${m.player1Name} vs ${m.player2Name}</h4>
                                    <p style="color:#5f6368">${m.type === 'individual' ? 'ê°œì¸ì „' : 'íŒ€ì „'} Â· ì™„ë£Œ</p>
                                </div>
                            `).join('')}
                        ` : ''}
                        ${matches.length === 0 ? '<p style="text-align:center; padding:40px; color:#5f6368">ì•„ì§ ìƒì„±ëœ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>' : ''}
                        <button class="btn btn-primary" onclick="goTo('home')" style="margin-top:20px">ğŸ  í™ˆìœ¼ë¡œ</button>
                    </div>
                `;
            }
        }

        function goTo(s) {
            screen = s;
            render();
        }

        function createMatch() {
            const type = document.getElementById('matchType').value;
            const player1 = document.getElementById('player1').value.trim();
            const player2 = document.getElementById('player2').value.trim();
            
            if (!player1 || !player2) {
                alert('ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
                speak('ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            const sets = type === 'individual' ? parseInt(document.getElementById('sets').value) : 1;
            currentMatch = {
                id: Date.now(),
                type,
                sets,
                player1Name: player1,
                player2Name: player2,
                winScore: type === 'individual' ? 11 : 31,
                currentSet: 1,
                setScores: [{player1: 0, player2: 0}],
                currentServe: 'player1',
                serveCount: 0,
                status: 'active',
                history: [],
                createdAt: new Date().toISOString()
            };
            
            matches.push(currentMatch);
            saveMatches();
            speak(`${type === 'individual' ? 'ê°œì¸ì „' : 'íŒ€ì „'} ê²½ê¸° ì‹œì‘. ${player1} ëŒ€ ${player2}`);
            screen = 'match';
            render();
        }

        function addScore(player, points, type) {
            const set = currentMatch.setScores[currentMatch.currentSet - 1];
            if (player === 'player1') set.player1 += points;
            else set.player2 += points;
            
            currentMatch.history.unshift({
                time: new Date().toLocaleTimeString('ko-KR'),
                player: player === 'player1' ? currentMatch.player1Name : currentMatch.player2Name,
                type,
                points,
                set: currentMatch.currentSet
            });
            
            currentMatch.serveCount++;
            if (currentMatch.serveCount >= 2) {
                currentMatch.currentServe = currentMatch.currentServe === 'player1' ? 'player2' : 'player1';
                currentMatch.serveCount = 0;
            }
            
            const score = player === 'player1' ? set.player1 : set.player2;
            const playerName = player === 'player1' ? currentMatch.player1Name : currentMatch.player2Name;
            speak(`${playerName}, ${type}, ${points}ì  ë“ì . í˜„ì¬ ${score}ì `);
            
            saveMatches();
            render();
        }

        function undo() {
            if (currentMatch.history.length === 0) return;
            
            const last = currentMatch.history.shift();
            const set = currentMatch.setScores[currentMatch.currentSet - 1];
            
            if (last.player === currentMatch.player1Name) set.player1 -= last.points;
            else set.player2 -= last.points;
            
            currentMatch.serveCount--;
            if (currentMatch.serveCount < 0) {
                currentMatch.currentServe = currentMatch.currentServe === 'player1' ? 'player2' : 'player1';
                currentMatch.serveCount = 1;
            }
            
            speak('ë§ˆì§€ë§‰ ë“ì  ì·¨ì†Œë¨');
            saveMatches();
            render();
        }

        function endSet() {
            const set = currentMatch.setScores[currentMatch.currentSet - 1];
            const diff = Math.abs(set.player1 - set.player2);
            const max = Math.max(set.player1, set.player2);
            
            if (max < currentMatch.winScore) {
                alert(`${currentMatch.winScore}ì  ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤`);
                return;
            }
            if (diff < 2) {
                alert('2ì  ì´ìƒ ì°¨ì´ê°€ ë‚˜ì•¼ í•©ë‹ˆë‹¤');
                return;
            }
            
            if (currentMatch.currentSet < currentMatch.sets) {
                speak(`ì„¸íŠ¸ ${currentMatch.currentSet} ì¢…ë£Œ. ${set.player1} ëŒ€ ${set.player2}`);
                currentMatch.currentSet++;
                currentMatch.setScores.push({player1: 0, player2: 0});
                currentMatch.serveCount = 0;
                saveMatches();
                render();
            } else {
                if (confirm('ê²½ê¸°ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    currentMatch.status = 'finished';
                    currentMatch.finishedAt = new Date().toISOString();
                    saveMatches();
                    speak('ê²½ê¸° ì¢…ë£Œ');
                    screen = 'home';
                    render();
                }
            }
        }

        function loadMatch(index, isActive) {
            const list = isActive ? matches.filter(m => m.status === 'active') : matches.filter(m => m.status === 'finished');
            currentMatch = list[index];
            screen = 'match';
            render();
        }

        // ì´ˆê¸°í™”
        if (localStorage.getItem('highContrast') === 'true') {
            document.body.classList.add('high-contrast');
        }
        render();
    </script>
</body>
</html>
